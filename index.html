<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Dream Harbour - Complete Service Management</title>
  <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    html, body { height: 100%; }
    body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif; background: #f8fafb; color: #1a202c; }
    
    .login-wrapper { display: flex; height: 100vh; }
    
    .login-side { 
      flex: 1; 
      background: linear-gradient(135deg, #1e40af 0%, #1e3a8a 50%, #0c4a6e 100%);
      display: flex; 
      flex-direction: column;
      align-items: center; 
      justify-content: center; 
      padding: 40px 20px;
      position: relative;
      overflow: hidden;
    }
    
    .login-side::before {
      content: '';
      position: absolute;
      width: 400px;
      height: 400px;
      background: rgba(255, 255, 255, 0.1);
      border-radius: 50%;
      bottom: -100px;
      right: -100px;
    }
    
    .login-side::after {
      content: '';
      position: absolute;
      width: 300px;
      height: 300px;
      background: rgba(255, 255, 255, 0.05);
      border-radius: 50%;
      top: -50px;
      left: -50px;
    }
    
    .login-side-content { 
      text-align: center; 
      color: white;
      position: relative;
      z-index: 1;
      max-width: 400px;
    }
    
    .logo-section {
      margin-bottom: 40px;
      animation: slideInDown 0.6s ease-out;
    }
    
    .logo-img {
      width: 100px;
      height: 100px;
      margin: 0 auto 20px;
      background: rgba(255, 255, 255, 0.95);
      border-radius: 20px;
      padding: 10px;
      box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
    }
    
    .logo-img img {
      width: 100%;
      height: 100%;
      object-fit: contain;
    }
    
    .brand-title {
      font-size: 42px;
      font-weight: 700;
      margin-bottom: 8px;
      letter-spacing: -0.5px;
    }
    
    .brand-subtitle {
      font-size: 16px;
      font-weight: 300;
      opacity: 0.95;
      margin-bottom: 50px;
    }
    
    .services-list {
      text-align: left;
      display: inline-block;
    }
    
    .services-list h3 {
      font-size: 14px;
      font-weight: 600;
      opacity: 0.9;
      margin-bottom: 15px;
      text-transform: uppercase;
      letter-spacing: 1px;
    }
    
    #dynamicServices {
      list-style: none;
      line-height: 2;
      font-size: 14px;
    }
    
    #dynamicServices li {
      display: flex;
      align-items: center;
      opacity: 0.9;
    }
    
    #dynamicServices li::before {
      content: '✓';
      margin-right: 10px;
      font-weight: bold;
      font-size: 16px;
    }
    
    .login-form-side { 
      flex: 1; 
      display: flex; 
      align-items: center; 
      justify-content: center; 
      padding: 40px 20px;
      background: white;
    }
    
    .login-form-container {
      width: 100%;
      max-width: 420px;
      animation: slideInUp 0.6s ease-out;
    }
    
    .login-header {
      margin-bottom: 40px;
    }
    
    .login-header h1 {
      font-size: 32px;
      font-weight: 700;
      margin-bottom: 8px;
      color: #1a202c;
    }
    
    .login-header p {
      font-size: 14px;
      color: #718096;
    }
    
    .form-group {
      margin-bottom: 24px;
    }
    
    .form-group label {
      display: block;
      font-size: 12px;
      font-weight: 600;
      color: #2d3748;
      margin-bottom: 8px;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }
    
    .phone-input-wrapper {
      display: flex;
      gap: 8px;
    }
    
    .country-code {
      flex: 0 0 90px;
      padding: 12px 12px;
      border: 2px solid #e2e8f0;
      border-radius: 8px;
      font-size: 14px;
      font-weight: 500;
      background: white;
      cursor: pointer;
      transition: border-color 0.3s;
    }
    
    .country-code:focus {
      outline: none;
      border-color: #1e40af;
      box-shadow: 0 0 0 3px rgba(30, 64, 175, 0.1);
    }
    
    .phone-input {
      flex: 1;
      padding: 12px 16px;
      border: 2px solid #e2e8f0;
      border-radius: 8px;
      font-size: 14px;
      transition: all 0.3s;
    }
    
    .phone-input:focus {
      outline: none;
      border-color: #1e40af;
      box-shadow: 0 0 0 3px rgba(30, 64, 175, 0.1);
    }
    
    .send-otp-btn {
      width: 100%;
      padding: 14px 20px;
      background: linear-gradient(135deg, #1e40af 0%, #1e3a8a 100%);
      color: white;
      border: none;
      border-radius: 8px;
      font-size: 14px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      box-shadow: 0 4px 15px rgba(30, 64, 175, 0.3);
    }
    
    .send-otp-btn:hover:not(:disabled) {
      transform: translateY(-2px);
      box-shadow: 0 6px 25px rgba(30, 64, 175, 0.4);
    }
    
    .send-otp-btn:active:not(:disabled) {
      transform: translateY(0);
    }
    
    .send-otp-btn:disabled {
      opacity: 0.6;
      cursor: not-allowed;
    }
    
    .otp-section {
      display: none;
    }
    
    .otp-input {
      width: 100%;
      padding: 12px 16px;
      border: 2px solid #e2e8f0;
      border-radius: 8px;
      font-size: 14px;
      margin-bottom: 16px;
      transition: all 0.3s;
    }
    
    .otp-input:focus {
      outline: none;
      border-color: #1e40af;
      box-shadow: 0 0 0 3px rgba(30, 64, 175, 0.1);
    }
    
    .otp-input.error {
      border-color: #dc2626;
      box-shadow: 0 0 0 3px rgba(220, 38, 38, 0.1);
    }
    
    .verify-otp-btn {
      width: 100%;
      padding: 14px 20px;
      background: linear-gradient(135deg, #059669 0%, #047857 100%);
      color: white;
      border: none;
      border-radius: 8px;
      font-size: 14px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      box-shadow: 0 4px 15px rgba(5, 150, 105, 0.3);
    }
    
    .verify-otp-btn:hover:not(:disabled) {
      transform: translateY(-2px);
      box-shadow: 0 6px 25px rgba(5, 150, 105, 0.4);
    }
    
    .verify-otp-btn:disabled {
      opacity: 0.6;
      cursor: not-allowed;
    }
    
    .security-badge {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 6px;
      font-size: 12px;
      color: #718096;
      margin-top: 20px;
    }
    
    .security-badge::before {
      content: '🔒';
    }
    
    .error-message {
      color: #dc2626;
      font-size: 12px;
      margin-bottom: 16px;
      padding: 10px 12px;
      background: #fee2e2;
      border-radius: 6px;
      display: none;
    }
    
    .error-message.show {
      display: block;
    }
    
    .success-message {
      color: #059669;
      font-size: 12px;
      margin-bottom: 16px;
      padding: 10px 12px;
      background: #d1fae5;
      border-radius: 6px;
      display: none;
    }
    
    .success-message.show {
      display: block;
    }
    
    .dashboard { display: none; }
    .dashboard.active { display: flex; }
    
    .dashboard {
      height: 100vh;
      flex-direction: column;
    }
    
    .sidebar {
      width: 280px;
      background: linear-gradient(135deg, #1e40af 0%, #1e3a8a 100%);
      color: white;
      padding: 30px 20px;
      overflow-y: auto;
      box-shadow: 2px 0 10px rgba(0, 0, 0, 0.1);
    }
    
    .sidebar-header {
      display: flex;
      align-items: center;
      gap: 12px;
      margin-bottom: 40px;
      padding-bottom: 20px;
      border-bottom: 1px solid rgba(255, 255, 255, 0.1);
    }
    
    .sidebar-logo {
      width: 40px;
      height: 40px;
      background: rgba(255, 255, 255, 0.95);
      border-radius: 10px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 700;
      color: #1e40af;
    }
    
    .sidebar-title {
      font-size: 18px;
      font-weight: 700;
    }
    
    .nav-item {
      padding: 12px 16px;
      margin-bottom: 8px;
      cursor: pointer;
      border-radius: 8px;
      transition: all 0.3s;
      font-size: 14px;
      font-weight: 500;
    }
    
    .nav-item:hover {
      background: rgba(255, 255, 255, 0.15);
    }
    
    .nav-item.active {
      background: rgba(255, 255, 255, 0.25);
      border-left: 3px solid white;
      padding-left: 13px;
    }
    
    .main-content {
      flex: 1;
      display: flex;
      flex-direction: column;
      background: #f8fafb;
      overflow: hidden;
    }
    
    .topbar {
      background: white;
      padding: 20px 30px;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    
    .topbar-title {
      font-size: 24px;
      font-weight: 700;
      color: #1a202c;
    }
    
    .user-menu {
      display: flex;
      gap: 15px;
    }
    
    .logout-btn {
      padding: 8px 16px;
      background: #fee2e2;
      color: #dc2626;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      font-size: 14px;
      font-weight: 600;
      transition: all 0.3s;
    }
    
    .logout-btn:hover {
      background: #fca5a5;
    }
    
    .content-area {
      flex: 1;
      overflow-y: auto;
      padding: 30px;
    }
    
    .cards-container {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 20px;
      margin-bottom: 30px;
    }
    
    .stat-card {
      background: white;
      padding: 24px;
      border-radius: 12px;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
      transition: all 0.3s;
    }
    
    .stat-card:hover {
      transform: translateY(-4px);
      box-shadow: 0 8px 20px rgba(0, 0, 0, 0.12);
    }
    
    .stat-label {
      font-size: 12px;
      color: #718096;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      margin-bottom: 8px;
      font-weight: 600;
    }
    
    .stat-value {
      font-size: 32px;
      font-weight: 700;
      color: #1a202c;
    }
    
    .form-section {
      background: white;
      padding: 24px;
      border-radius: 12px;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
      margin-bottom: 24px;
    }
    
    .section-title {
      font-size: 18px;
      font-weight: 700;
      color: #1a202c;
      margin-bottom: 20px;
      padding-bottom: 12px;
      border-bottom: 2px solid #e2e8f0;
    }
    
    .form-row {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 16px;
      margin-bottom: 16px;
    }
    
    .form-field {
      display: flex;
      flex-direction: column;
    }
    
    .form-field label {
      font-size: 12px;
      font-weight: 600;
      color: #2d3748;
      margin-bottom: 6px;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }
    
    .form-field input,
    .form-field select,
    .form-field textarea {
      padding: 10px 12px;
      border: 2px solid #e2e8f0;
      border-radius: 6px;
      font-size: 14px;
      font-family: inherit;
      transition: all 0.3s;
    }
    
    .form-field input:focus,
    .form-field select:focus,
    .form-field textarea:focus {
      outline: none;
      border-color: #1e40af;
      box-shadow: 0 0 0 3px rgba(30, 64, 175, 0.1);
    }
    
    .btn {
      padding: 10px 20px;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      font-size: 14px;
      font-weight: 600;
      transition: all 0.3s;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }
    
    .btn-primary {
      background: linear-gradient(135deg, #1e40af 0%, #1e3a8a 100%);
      color: white;
      box-shadow: 0 4px 15px rgba(30, 64, 175, 0.3);
    }
    
    .btn-primary:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 25px rgba(30, 64, 175, 0.4);
    }
    
    .btn-success {
      background: linear-gradient(135deg, #059669 0%, #047857 100%);
      color: white;
    }
    
    .btn-danger {
      background: #fee2e2;
      color: #dc2626;
    }
    
    .btn-danger:hover {
      background: #fca5a5;
    }
    
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 16px;
    }
    
    table th {
      background: #f7fafc;
      padding: 12px;
      text-align: left;
      font-weight: 600;
      font-size: 12px;
      color: #2d3748;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      border-bottom: 2px solid #e2e8f0;
    }
    
    table td {
      padding: 12px;
      border-bottom: 1px solid #e2e8f0;
      font-size: 14px;
    }
    
    table tr:hover {
      background: #f7fafc;
    }
    
    @keyframes slideInDown {
      from {
        opacity: 0;
        transform: translateY(-30px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }
    
    @keyframes slideInUp {
      from {
        opacity: 0;
        transform: translateY(30px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }
    
    @media (max-width: 1024px) {
      .login-wrapper { flex-direction: column; }
      .login-side { flex: 0 0 auto; padding: 30px 20px; }
      .login-form-side { flex: 1; }
      .sidebar { width: 100%; max-height: 60px; overflow-x: auto; padding: 12px 20px; }
    }
  </style>
</head>
<body>

<!-- LOGIN PAGE -->
<div class="login-wrapper" id="loginPage">
  <div class="login-side">
    <div class="login-side-content">
      <div class="logo-section">
        <div class="logo-img" id="logoDisplay">
          <img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Crect fill='%231e40af' width='100' height='100' rx='15'/%3E%3Cpath fill='%23fff' d='M50 20c-8 0-15 5-18 12l-2 4v30l2 4c3 7 10 12 18 12s15-5 18-12l2-4V36l-2-4c-3-7-10-12-18-12z' opacity='0.8'/%3E%3Ccircle cx='50' cy='45' r='6' fill='%23fff' opacity='0.6'/%3E%3C/svg%3E" alt="Dream Harbour">
        </div>
        <div class="brand-title">Dream Harbour</div>
        <div class="brand-subtitle">Complete Service Management</div>
      </div>
      
      <div class="services-list">
        <h3>Services We Offer:</h3>
        <ul id="dynamicServices">
          <li>Photocopy & Printing</li>
          <li>Document Services</li>
          <li>Online Services</li>
          <li>Government Certificates</li>
          <li>Money Transfer</li>
          <li>Professional Invoicing</li>
          <li>GST Compliance</li>
          <li>Advanced Analytics</li>
        </ul>
      </div>
    </div>
  </div>
  
  <div class="login-form-side">
    <div class="login-form-container">
      <div class="login-header">
        <h1>Sign In</h1>
        <p>Enter your phone number to get started</p>
      </div>
      
      <form id="loginForm">
        <div class="error-message" id="errorMessage"></div>
        <div class="success-message" id="successMessage"></div>
        
        <div id="phoneSection">
          <div class="form-group">
            <label>PHONE NUMBER</label>
            <div class="phone-input-wrapper">
              <select id="countryCode" class="country-code">
                <option value="+91">IN +91</option>
                <option value="+1">US +1</option>
                <option value="+44">UK +44</option>
                <option value="+61">AU +61</option>
                <option value="+971">AE +971</option>
              </select>
              <input type="tel" id="phoneNumber" class="phone-input" placeholder="9876543210" required>
            </div>
          </div>
          
          <button type="button" class="send-otp-btn" id="sendOtpBtn">Send OTP</button>
        </div>
        
        <div class="otp-section" id="otpSection">
          <div class="form-group">
            <label>OTP</label>
            <input type="text" id="otpInput" class="otp-input" placeholder="Enter 6-digit OTP" maxlength="6" required>
          </div>
          <button type="button" class="verify-otp-btn" id="verifyOtpBtn">Verify & Login</button>
          <button type="button" class="btn" id="resendOtpBtn" style="width: 100%; margin-top: 10px; background: #f3f4f6; color: #4b5563;">Resend OTP</button>
        </div>
        
        <div class="security-badge">
          Your data is secure and encrypted
        </div>
      </form>
    </div>
  </div>
</div>

<!-- DASHBOARD PAGE -->
<div class="dashboard" id="dashboardPage">
  <div style="display: flex; height: 100vh;">
    <div class="sidebar" id="sidebar">
      <div class="sidebar-header">
        <div class="sidebar-logo">DH</div>
        <div class="sidebar-title">Dream Harbour</div>
      </div>
      <nav id="mainNav">
        <div class="nav-item active" onclick="showSection('dashboard')">📊 Dashboard</div>
        <div class="nav-item" onclick="showSection('services')">🛠️ Services</div>
        <div class="nav-item" onclick="showSection('customers')">👥 Customers</div>
        <div class="nav-item" onclick="showSection('invoices')">📄 Invoices</div>
        <div class="nav-item" onclick="showSection('reports')">📈 Reports</div>
        <div class="nav-item" onclick="showSection('settings')">⚙️ Settings</div>
      </nav>
    </div>
    
    <div class="main-content">
      <div class="topbar">
        <div class="topbar-title" id="pageTitle">Dashboard</div>
        <div class="user-menu">
          <button class="logout-btn" onclick="logout()">Logout</button>
        </div>
      </div>
      
      <div class="content-area">
        
        <!-- DASHBOARD SECTION -->
        <div id="dashboard-section" class="section-content">
          <div class="cards-container">
            <div class="stat-card">
              <div class="stat-label">Total Revenue</div>
              <div class="stat-value" id="totalRevenue">₹0</div>
            </div>
            <div class="stat-card">
              <div class="stat-label">GST Collected</div>
              <div class="stat-value" id="gstCollected">₹0</div>
            </div>
            <div class="stat-card">
              <div class="stat-label">Services Added</div>
              <div class="stat-value" id="serviceCount">0</div>
            </div>
            <div class="stat-card">
              <div class="stat-label">Total Customers</div>
              <div class="stat-value" id="customerCount">0</div>
            </div>
          </div>
          
          <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
            <div class="form-section">
              <h3 style="font-size: 16px; margin-bottom: 15px;">Service-wise Revenue</h3>
              <canvas id="serviceChart" height="80"></canvas>
            </div>
            <div class="form-section">
              <h3 style="font-size: 16px; margin-bottom: 15px;">Monthly Revenue Trend</h3>
              <canvas id="revenueChart" height="80"></canvas>
            </div>
          </div>
        </div>
        
        <!-- SERVICES SECTION -->
        <div id="services-section" class="section-content" style="display: none;">
          <div class="form-section">
            <h2 class="section-title">Add New Service</h2>
            <form id="serviceForm">
              <div class="form-row">
                <div class="form-field">
                  <label>Service Type</label>
                  <select id="serviceType" required>
                    <option value="">Select Service</option>
                    <option value="Photocopy">Photocopy & Printing</option>
                    <option value="Document">Document Services</option>
                    <option value="Government">Government Certificates</option>
                    <option value="Online">Online Services</option>
                    <option value="Financial">Financial Services</option>
                    <option value="Money">Money Transfer</option>
                    <option value="Professional">Professional Services</option>
                    <option value="Consultation">Consultation</option>
                  </select>
                </div>
                <div class="form-field">
                  <label>Customer</label>
                  <select id="serviceCustomer" required>
                    <option value="">Select Customer</option>
                  </select>
                </div>
              </div>
              
              <div class="form-row">
                <div class="form-field">
                  <label>Amount (₹)</label>
                  <input type="number" id="serviceAmount" placeholder="0.00" step="0.01" required>
                </div>
                <div class="form-field">
                  <label>GST Rate (%)</label>
                  <input type="number" id="serviceGST" placeholder="5" step="0.1" value="5">
                </div>
              </div>
              
              <div class="form-field">
                <label>Description</label>
                <textarea id="serviceDescription" rows="3" placeholder="Service details..."></textarea>
              </div>
              
              <button type="submit" class="btn btn-primary">Add Service</button>
            </form>
          </div>
          
          <div class="form-section">
            <h2 class="section-title">Recent Services</h2>
            <table>
              <thead>
                <tr>
                  <th>Type</th>
                  <th>Customer</th>
                  <th>Amount</th>
                  <th>GST</th>
                  <th>Date</th>
                  <th>Action</th>
                </tr>
              </thead>
              <tbody id="servicesTable">
                <tr><td colspan="6" style="text-align: center; color: #999;">No services added yet</td></tr>
              </tbody>
            </table>
          </div>
        </div>
        
        <!-- CUSTOMERS SECTION -->
        <div id="customers-section" class="section-content" style="display: none;">
          <div class="form-section">
            <h2 class="section-title">Add New Customer</h2>
            <form id="customerForm">
              <div class="form-row">
                <div class="form-field">
                  <label>Full Name</label>
                  <input type="text" id="customerName" placeholder="John Doe" required>
                </div>
                <div class="form-field">
                  <label>Phone</label>
                  <input type="tel" id="customerPhone" placeholder="9876543210" required>
                </div>
              </div>
              
              <div class="form-row">
                <div class="form-field">
                  <label>Email</label>
                  <input type="email" id="customerEmail" placeholder="john@example.com">
                </div>
                <div class="form-field">
                  <label>GSTIN</label>
                  <input type="text" id="customerGSTIN" placeholder="27AABBU1234F1Z5">
                </div>
              </div>
              
              <div class="form-field">
                <label>Address</label>
                <textarea id="customerAddress" rows="2" placeholder="Full address..."></textarea>
              </div>
              
              <button type="submit" class="btn btn-primary">Add Customer</button>
            </form>
          </div>
          
          <div class="form-section">
            <h2 class="section-title">Customer List</h2>
            <table>
              <thead>
                <tr>
                  <th>Name</th>
                  <th>Phone</th>
                  <th>Email</th>
                  <th>GSTIN</th>
                  <th>Action</th>
                </tr>
              </thead>
              <tbody id="customersTable">
                <tr><td colspan="5" style="text-align: center; color: #999;">No customers added yet</td></tr>
              </tbody>
            </table>
          </div>
        </div>
        
        <!-- INVOICES SECTION -->
        <div id="invoices-section" class="section-content" style="display: none;">
          <div class="form-section">
            <h2 class="section-title">Create Invoice</h2>
            <form id="invoiceForm">
              <div class="form-row">
                <div class="form-field">
                  <label>Select Services</label>
                  <select id="invoiceServices" multiple required style="min-height: 120px;">
                  </select>
                  <small style="color: #999; display: block; margin-top: 5px;">Hold Ctrl/Cmd to select multiple</small>
                </div>
              </div>
              
              <button type="submit" class="btn btn-primary">Create Invoice</button>
            </form>
          </div>
          
          <div class="form-section">
            <h2 class="section-title">Invoices</h2>
            <table>
              <thead>
                <tr>
                  <th>Invoice #</th>
                  <th>Date</th>
                  <th>Amount</th>
                  <th>GST</th>
                  <th>Total</th>
                  <th>Action</th>
                </tr>
              </thead>
              <tbody id="invoicesTable">
                <tr><td colspan="6" style="text-align: center; color: #999;">No invoices created yet</td></tr>
              </tbody>
            </table>
          </div>
        </div>
        
        <!-- REPORTS SECTION -->
        <div id="reports-section" class="section-content" style="display: none;">
          <div class="form-section">
            <h2 class="section-title">GST Report</h2>
            <div class="form-row">
              <div class="form-field">
                <label>From Date</label>
                <input type="date" id="reportFromDate">
              </div>
              <div class="form-field">
                <label>To Date</label>
                <input type="date" id="reportToDate">
              </div>
            </div>
            <button class="btn btn-primary" onclick="generateGSTReport()">Generate Report</button>
            <button class="btn btn-success" onclick="exportTaxCSV()" style="margin-left: 10px;">Export CSV</button>
          </div>
          
          <div class="form-section">
            <h2 class="section-title">Report Details</h2>
            <table id="reportTable">
              <thead>
                <tr>
                  <th>Service Type</th>
                  <th>Transactions</th>
                  <th>Total Amount</th>
                  <th>GST Amount</th>
                </tr>
              </thead>
              <tbody>
                <tr><td colspan="4" style="text-align: center; color: #999;">Select date range and generate report</td></tr>
              </tbody>
            </table>
          </div>
        </div>
        
        <!-- SETTINGS SECTION -->
        <div id="settings-section" class="section-content" style="display: none;">
          <div class="form-section">
            <h2 class="section-title">Business Settings</h2>
            <form id="settingsForm">
              <div class="form-row">
                <div class="form-field">
                  <label>Business Name</label>
                  <input type="text" id="businessName" placeholder="Dream Harbour">
                </div>
                <div class="form-field">
                  <label>GSTIN</label>
                  <input type="text" id="businessGSTIN" placeholder="27AABBU1234F1Z5">
                </div>
              </div>
              
              <div class="form-row">
                <div class="form-field">
                  <label>Email</label>
                  <input type="email" id="businessEmail" placeholder="info@dreamharbour.com">
                </div>
                <div class="form-field">
                  <label>Phone</label>
                  <input type="tel" id="businessPhone" placeholder="9876543210">
                </div>
              </div>
              
              <div class="form-row">
                <div class="form-field">
                  <label>Default GST Rate (%)</label>
                  <input type="number" id="defaultGSTRate" placeholder="5" step="0.1">
                </div>
              </div>
              
              <div class="form-field">
                <label>Address</label>
                <textarea id="businessAddress" rows="3" placeholder="Full business address..."></textarea>
              </div>
              
              <button type="submit" class="btn btn-primary">Save Settings</button>
            </form>
          </div>
        </div>
        
      </div>
    </div>
  </div>
</div>

<script>
const firebaseConfig = {
  apiKey: "AIzaSyC-tQWS8o_Y7ZJtI3JjW9Uk4I9aHJ1ZDxs",
  authDomain: "dream-harbour.firebaseapp.com",
  projectId: "dream-harbour",
  storageBucket: "dream-harbour.firebasestorage.app",
  messagingSenderId: "857245144265",
  appId: "1:857245144265:web:6855412224da516592e918"
};

firebase.initializeApp(firebaseConfig);
const auth = firebase.auth();
const db = firebase.firestore();

let currentUser = null;
let servicesData = [];
let customersData = [];
let invoicesData = [];
let confirmationResult = null;

const SERVICESDATABASE = {
  'Photocopy': { sac: '998341', gst: 5 },
  'Document': { sac: '998399', gst: 5 },
  'Government': { sac: '998361', gst: 5 },
  'Online': { sac: '998366', gst: 5 },
  'Financial': { sac: '998369', gst: 5 },
  'Money': { sac: '998413', gst: 5 },
  'Professional': { sac: '998399', gst: 5 },
  'Consultation': { sac: '998341', gst: 5 }
};

// Helper functions for messages
function showError(message) {
  const errorEl = document.getElementById('errorMessage');
  errorEl.textContent = message;
  errorEl.classList.add('show');
  setTimeout(() => {
    errorEl.classList.remove('show');
  }, 5000);
}

function showSuccess(message) {
  const successEl = document.getElementById('successMessage');
  successEl.textContent = message;
  successEl.classList.add('show');
  setTimeout(() => {
    successEl.classList.remove('show');
  }, 3000);
}

// Clear login form
function resetLoginForm() {
  document.getElementById('phoneNumber').value = '';
  document.getElementById('countryCode').value = '+91';
  document.getElementById('otpInput').value = '';
  document.getElementById('otpSection').style.display = 'none';
  document.getElementById('phoneSection').style.display = 'block';
  document.getElementById('errorMessage').classList.remove('show');
  document.getElementById('successMessage').classList.remove('show');
  document.getElementById('otpInput').classList.remove('error');
  confirmationResult = null;
}

// Authentication - Send OTP
document.getElementById('sendOtpBtn').addEventListener('click', async () => {
  const phone = document.getElementById('countryCode').value + document.getElementById('phoneNumber').value;
  
  if (!document.getElementById('phoneNumber').value) {
    showError('Please enter a phone number');
    return;
  }
  
  try {
    document.getElementById('sendOtpBtn').disabled = true;
    document.getElementById('sendOtpBtn').textContent = 'Sending...';
    
    // Use phone sign-in directly without RecaptchaVerifier (more stable)
    confirmationResult = await auth.signInWithPhoneNumber(phone, window.recaptchaVerifier);
    
    document.getElementById('phoneSection').style.display = 'none';
    document.getElementById('otpSection').style.display = 'block';
    showSuccess('OTP sent to your phone');
    document.getElementById('sendOtpBtn').textContent = 'Send OTP';
    document.getElementById('sendOtpBtn').disabled = false;
    
  } catch (error) {
    console.error('Error sending OTP:', error.message);
    showError('Error: ' + (error.message || 'Could not send OTP. Try again.'));
    document.getElementById('sendOtpBtn').disabled = false;
    document.getElementById('sendOtpBtn').textContent = 'Send OTP';
  }
});

// Resend OTP
document.getElementById('resendOtpBtn').addEventListener('click', async () => {
  const phone = document.getElementById('countryCode').value + document.getElementById('phoneNumber').value;
  
  try {
    document.getElementById('resendOtpBtn').disabled = true;
    document.getElementById('resendOtpBtn').textContent = 'Resending...';
    
    confirmationResult = await auth.signInWithPhoneNumber(phone, window.recaptchaVerifier);
    showSuccess('OTP resent to your phone');
    
    document.getElementById('resendOtpBtn').textContent = 'Resend OTP';
    document.getElementById('resendOtpBtn').disabled = false;
  } catch (error) {
    console.error('Error resending OTP:', error.message);
    showError('Error resending OTP: ' + error.message);
    document.getElementById('resendOtpBtn').disabled = false;
    document.getElementById('resendOtpBtn').textContent = 'Resend OTP';
  }
});

// Verify OTP
document.getElementById('verifyOtpBtn').addEventListener('click', async () => {
  const otp = document.getElementById('otpInput').value;
  
  if (!otp || otp.length !== 6) {
    document.getElementById('otpInput').classList.add('error');
    showError('Please enter a valid 6-digit OTP');
    return;
  }
  
  if (!confirmationResult) {
    showError('OTP session expired. Please request a new OTP.');
    resetLoginForm();
    return;
  }
  
  try {
    document.getElementById('verifyOtpBtn').disabled = true;
    document.getElementById('verifyOtpBtn').textContent = 'Verifying...';
    
    const result = await confirmationResult.confirm(otp);
    currentUser = result.user;
    
    document.getElementById('verifyOtpBtn').textContent = 'Verify & Login';
    showSuccess('Login successful!');
    
    setTimeout(() => {
      showDashboard();
    }, 1000);
    
  } catch (error) {
    console.error('Error verifying OTP:', error.message);
    document.getElementById('verifyOtpBtn').disabled = false;
    document.getElementById('verifyOtpBtn').textContent = 'Verify & Login';
    document.getElementById('otpInput').classList.add('error');
    showError('Invalid OTP. Please try again.');
    document.getElementById('otpInput').value = '';
  }
});

// Clear error when user types
document.getElementById('otpInput').addEventListener('input', () => {
  document.getElementById('otpInput').classList.remove('error');
});

function showDashboard() {
  document.getElementById('loginPage').style.display = 'none';
  document.getElementById('dashboardPage').classList.add('active');
  loadDashboardData();
}

function logout() {
  auth.signOut().then(() => {
    document.getElementById('loginPage').style.display = 'flex';
    document.getElementById('dashboardPage').classList.remove('active');
    resetLoginForm();
    confirmationResult = null;
  }).catch(error => {
    console.error('Logout error:', error);
    showError('Error during logout');
  });
}

function showSection(section) {
  const sections = document.querySelectorAll('.section-content');
  sections.forEach(s => s.style.display = 'none');
  
  document.getElementById(section + '-section').style.display = 'block';
  document.querySelectorAll('.nav-item').forEach(item => item.classList.remove('active'));
  event.target.closest('.nav-item').classList.add('active');
  
  const titles = {
    'dashboard': 'Dashboard',
    'services': 'Services Management',
    'customers': 'Customer Management',
    'invoices': 'Invoice Management',
    'reports': 'GST Reports',
    'settings': 'Business Settings'
  };
  document.getElementById('pageTitle').textContent = titles[section] || section;
}

function loadDashboardData() {
  loadServices();
  loadCustomers();
  updateCards();
  updateCharts();
}

function updateCards() {
  const totalRevenue = servicesData.reduce((sum, s) => sum + s.amount, 0);
  const totalGST = servicesData.reduce((sum, s) => sum + (s.amount * s.gst / 100), 0);
  
  document.getElementById('totalRevenue').textContent = '₹' + totalRevenue.toFixed(2);
  document.getElementById('gstCollected').textContent = '₹' + totalGST.toFixed(2);
  document.getElementById('serviceCount').textContent = servicesData.length;
  document.getElementById('customerCount').textContent = customersData.length;
}

function updateCharts() {
  const serviceTypes = [...new Set(servicesData.map(s => s.type))];
  const serviceRevenue = serviceTypes.map(type => 
    servicesData.filter(s => s.type === type).reduce((sum, s) => sum + s.amount, 0)
  );
  
  const ctx1 = document.getElementById('serviceChart').getContext('2d');
  new Chart(ctx1, {
    type: 'doughnut',
    data: {
      labels: serviceTypes.length > 0 ? serviceTypes : ['No Data'],
      datasets: [{
        data: serviceRevenue.length > 0 ? serviceRevenue : [1],
        backgroundColor: ['#1e40af', '#0891b2', '#059669', '#d97706', '#7c3aed', '#dc2626', '#0ea5e9', '#f59e0b']
      }]
    }
  });
  
  const ctx2 = document.getElementById('revenueChart').getContext('2d');
  new Chart(ctx2, {
    type: 'line',
    data: {
      labels: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun'],
      datasets: [{
        label: 'Revenue',
        data: [0, 0, 0, 0, 0, 0],
        borderColor: '#1e40af',
        backgroundColor: 'rgba(30, 64, 175, 0.1)',
        tension: 0.4
      }]
    }
  });
}

function loadServices() {
  const dropdown = document.getElementById('invoiceServices');
  dropdown.innerHTML = '';
  
  servicesData.forEach(service => {
    const option = document.createElement('option');
    option.value = service.id;
    option.textContent = `${service.type} - ₹${service.amount} (${new Date(service.date).toLocaleDateString()})`;
    dropdown.appendChild(option);
  });
}

function loadCustomers() {
  const dropdown = document.getElementById('serviceCustomer');
  dropdown.innerHTML = '<option value="">Select Customer</option>';
  
  customersData.forEach(customer => {
    const option = document.createElement('option');
    option.value = customer.id;
    option.textContent = customer.name + ' (' + customer.phone + ')';
    dropdown.appendChild(option);
  });
}

// Form Submissions
document.getElementById('serviceForm').addEventListener('submit', (e) => {
  e.preventDefault();
  const service = {
    id: Date.now().toString(),
    type: document.getElementById('serviceType').value,
    customer: document.getElementById('serviceCustomer').value,
    amount: parseFloat(document.getElementById('serviceAmount').value),
    gst: parseFloat(document.getElementById('serviceGST').value),
    description: document.getElementById('serviceDescription').value,
    date: new Date().toISOString()
  };
  
  servicesData.push(service);
  document.getElementById('serviceForm').reset();
  updateCards();
  updateCharts();
  loadServices();
  alert('Service added successfully!');
});

document.getElementById('customerForm').addEventListener('submit', (e) => {
  e.preventDefault();
  const customer = {
    id: Date.now().toString(),
    name: document.getElementById('customerName').value,
    phone: document.getElementById('customerPhone').value,
    email: document.getElementById('customerEmail').value,
    gstin: document.getElementById('customerGSTIN').value,
    address: document.getElementById('customerAddress').value
  };
  
  customersData.push(customer);
  document.getElementById('customerForm').reset();
  loadCustomers();
  alert('Customer added successfully!');
});

function generateGSTReport() {
  alert('Report generated!');
}

function exportTaxCSV() {
  alert('CSV exported!');
}

// Check if user is logged in on page load
firebase.auth().onAuthStateChanged(user => {
  if (user) {
    currentUser = user;
    showDashboard();
  }
});
</script>

</body>
</html>
